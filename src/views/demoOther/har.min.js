/*! har.min.js Version:1.0.22 BuildTime:2024/11/14 20:17:15 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.har=t():e.har=t()}(self,(function(){return function(){"use strict";var e={d:function(t,n){for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};var t={};e.d(t,{default:function(){return j}});var n=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var n=-1;return e.some((function(e,i){return e[0]===t&&(n=i,!0)})),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var n=e(this.__entries__,t),i=this.__entries__[n];return i&&i[1]},t.prototype.set=function(t,n){var i=e(this.__entries__,t);~i?this.__entries__[i][1]=n:this.__entries__.push([t,n])},t.prototype.delete=function(t){var n=this.__entries__,i=e(n,t);~i&&n.splice(i,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var n=0,i=this.__entries__;n<i.length;n++){var o=i[n];e.call(t,o[1],o[0])}},t}()}(),i="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,o=void 0!==e.g&&e.g.Math===Math?e.g:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),s="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(o):function(e){return setTimeout((function(){return e(Date.now())}),1e3/60)};var r=["top","right","bottom","left","width","height","size","weight"],c="undefined"!=typeof MutationObserver,a=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var n=!1,i=!1,o=0;function r(){n&&(n=!1,e()),i&&a()}function c(){s(r)}function a(){var e=Date.now();if(n){if(e-o<2)return;i=!0}else n=!0,i=!1,setTimeout(c,t);o=e}return a}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,n=t.indexOf(e);~n&&t.splice(n,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter((function(e){return e.gatherActive(),e.hasActive()}));return e.forEach((function(e){return e.broadcastActive()})),e.length>0},e.prototype.connect_=function(){i&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),c?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){i&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,n=void 0===t?"":t;r.some((function(e){return!!~n.indexOf(e)}))&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),l=function(e,t){for(var n=0,i=Object.keys(t);n<i.length;n++){var o=i[n];Object.defineProperty(e,o,{value:t[o],enumerable:!1,writable:!1,configurable:!0})}return e},d=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||o},h=m(0,0,0,0);function u(e){return parseFloat(e)||0}function p(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.reduce((function(t,n){return t+u(e["border-"+n+"-width"])}),0)}function w(e){var t=e.clientWidth,n=e.clientHeight;if(!t&&!n)return h;var i=d(e).getComputedStyle(e),o=function(e){for(var t={},n=0,i=["top","right","bottom","left"];n<i.length;n++){var o=i[n],s=e["padding-"+o];t[o]=u(s)}return t}(i),s=o.left+o.right,r=o.top+o.bottom,c=u(i.width),a=u(i.height);if("border-box"===i.boxSizing&&(Math.round(c+s)!==t&&(c-=p(i,"left","right")+s),Math.round(a+r)!==n&&(a-=p(i,"top","bottom")+r)),!function(e){return e===d(e).document.documentElement}(e)){var l=Math.round(c+s)-t,w=Math.round(a+r)-n;1!==Math.abs(l)&&(c-=l),1!==Math.abs(w)&&(a-=w)}return m(o.left,o.top,c,a)}var f="undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof d(e).SVGGraphicsElement}:function(e){return e instanceof d(e).SVGElement&&"function"==typeof e.getBBox};function _(e){return i?f(e)?function(e){var t=e.getBBox();return m(0,0,t.width,t.height)}(e):w(e):h}function m(e,t,n,i){return{x:e,y:t,width:n,height:i}}var v=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=m(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=_(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),b=function(e,t){var n,i,o,s,r,c,a,d=(i=(n=t).x,o=n.y,s=n.width,r=n.height,c="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,a=Object.create(c.prototype),l(a,{x:i,y:o,width:s,height:r,top:o,right:i+s,bottom:r+o,left:i}),a);l(this,{target:e,contentRect:d})},g=function(){function e(e,t,i){if(this.activeObservations_=[],this.observations_=new n,"function"!=typeof e)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=i}return e.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof d(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new v(e)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof d(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach((function(t){t.isActive()&&e.activeObservations_.push(t)}))},e.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map((function(e){return new b(e.target,e.broadcastRect())}));this.callback_.call(e,t,e),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),k="undefined"!=typeof WeakMap?new WeakMap:new n,y=function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var n=a.getInstance(),i=new g(t,n,this);k.set(this,i)};["observe","unobserve","disconnect"].forEach((function(e){y.prototype[e]=function(){var t;return(t=k.get(this))[e].apply(t,arguments)}}));var C=void 0!==o.ResizeObserver?o.ResizeObserver:y;class x{constructor(){this._events={}}on(e,t){this._events[e]?this._events[e].push(t):this._events[e]=[t]}emit(e,...t){return!!this._events[e]&&(this._events[e].forEach((e=>e(...t))),!0)}off(e,t){const n=this._events[e];if(n)for(let e=0;e<n.length;e++)n[e]!==t&&n[e]!==t.fn||n.splice(e,1)}once(e,t){const n=(...i)=>{t(...i),this.off(e,n)};return t.fn=n,this.on(e,n),this}}var E=function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function r(e){try{a(i.next(e))}catch(e){s(e)}}function c(e){try{a(i.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((i=i.apply(e,t||[])).next())}))};let A=-1/0,S=-1/0;class I extends x{constructor(e,t){super(),this._clientFullscreen=!1,this._arWindowChanged=!1,this._scrollCallbacks=[],this._mos=[],this._windowsVisible=new Map,this._windowScale=new Map,this._visible=!0,this._domVisible=!0,this._pageVisible=!0,this._frameInfo={x:0,y:0},this._controlReady=!1,this._dpi=void 0,this._version="unknown",this._radio=1,this._domId=e,t&&Object.assign(this._frameInfo,t),this._element=document.getElementById(e),this._initEventListener(),this._observeWindowLocation()}get element(){return this._element}get visible(){return this._pageVisible&&this._domVisible}get ClientFullscreen(){return this._clientFullscreen}set ClientFullscreen(e){this._clientFullscreen=e}get controlReady(){return this._controlReady}set dpi(e){this._dpi=e}set version(e){this._version=e}set controlReady(e){this._controlReady=e}_initEventListener(){var e;if(top){const e=window;e.blurNum=0,e.focusNum=0,e.onblur=()=>{e.blurNum=performance.now()},e.onfocus=()=>{clearInterval(this._resetTimer),e.focusNum=performance.now()},top.document.onvisibilitychange=()=>{Math.abs(e.focusNum-e.blurNum)<3e3&&(e.focusNum>e.blurNum?(this._arWindowChanged=!0,this.emit("change-window"),this.emit("show-tab")):this._arWindowChanged&&(this._arWindowChanged=!1,this.emit("change-window"),this._resetTimer=setInterval((()=>{e.blurNum=performance.now()}),1e3)))}}this._beforeunloadCallback=R.bind(this),this._visibilitychangeCallback=T.bind(this),this._keyDownCallback=e=>E(this,void 0,void 0,(function*(){if(e&&"F11"===e.code){if(D(this._version,"2.2.0"))return;e.preventDefault(),null!==document.fullscreenElement?(yield document.exitFullscreen(),this.emit("update-control")):document.documentElement.requestFullscreen()}})),null===top||void 0===top||top.window.addEventListener("beforeunload",this._beforeunloadCallback),null===top||void 0===top||top.document.addEventListener("visibilitychange",this._visibilitychangeCallback),null===top||void 0===top||top.document.addEventListener("keydown",this._keyDownCallback),this._batchObserveElement(window),this._ro=new C((e=>{for(const t of e)if(t.target.id===this._element.id){const{left:e,top:n,width:i,height:o}=t.contentRect,s=D(this._version,"2.1.0"),r=s?100:800,c=s?100:600;(i<r&&i>0||o<c&&i>0)&&console.warn(`AR控件最小分辨率为${r}*${c}，请调整AR控件DOM容器大小！`),0===i&&0===o||this.emit("update-control",!0)}else this.emit("update-control",!0)})),this._ro.observe(this._element),window.top&&this._ro.observe(null===(e=window.top)||void 0===e?void 0:e.document.documentElement),this._io=new IntersectionObserver((e=>{for(const t of e)t.target.id===this._element.id&&this.emit("update-control",!1)})),this._io.observe(this._element),null===top||void 0===top||top.window.addEventListener("message",N),window.showTabCallback=()=>{this._pageVisible=!0,this._domVisible&&this.emit("show-control")},window.hideTabCallback=()=>{this._pageVisible=!1,this.emit("hide-control")},window.frameInfoChangeCallback=e=>{Object.assign(this._frameInfo,e)}}removeEventListener(){var e,t,n;top&&(top.onblur=null,top.onfocus=null,top.document.onvisibilitychange=null,clearInterval(this._resetTimer)),this._beforeunloadCallback&&(null===top||void 0===top||top.window.removeEventListener("beforeunload",this._beforeunloadCallback)),this._visibilitychangeCallback&&(null===top||void 0===top||top.document.removeEventListener("visibilitychange",this._visibilitychangeCallback)),this._keyDownCallback&&(null===top||void 0===top||top.document.removeEventListener("keydown",this._keyDownCallback)),null===(e=this._mos)||void 0===e||e.forEach((e=>{e.disconnect()})),null===(t=this._ro)||void 0===t||t.disconnect(),null===(n=this._io)||void 0===n||n.disconnect(),this._scrollCallbacks.forEach((e=>{e.window.removeEventListener("scroll",e.callback,!0)})),null===top||void 0===top||top.window.removeEventListener("message",N)}_observeWindowLocation(){this._observeTimer=setInterval((()=>{var e,t;if(this._element||(this._element=document.getElementById(this._domId),this._element&&(null===(e=this._io)||void 0===e||e.observe(this._element),null===(t=this._ro)||void 0===t||t.observe(this._element))),(window.screenX!==A||window.screenY!==S)&&window.screenX>-32e3&&window.screenY>-32e3){A=window.screenX,S=window.screenY;let e=setTimeout((()=>{this.emit("update-control",!1),clearTimeout(e)}),200)}}),16)}getDomPosition(e=!1,t=!1){var n;const i=[...this._windowScale.values()].reduce(((e,t)=>{const n=[...t.values()].reduce(((e,t)=>[e[0]*t[0],e[1]*t[1]]),[1,1]);return[e[0]*n[0],e[1]*n[1]]}),[1,1]),{x:o,y:s,left:r,top:c,width:a,height:l}=null===(n=this._element)||void 0===n?void 0:n.getBoundingClientRect(),d=this._currentFrameAbsolutePosition(),h=this._dpi?window.devicePixelRatio/this._dpi:function(){if(screen.width<=window.outerWidth){const e=96,t=window.screen.width,n=window.screen.height,i=t/(window.innerWidth*(e/96)),o=n/(window.innerHeight*(e/96));P=Math.min(i,o)}return P}(),u=null!=o?o:r,p=null!=s?s:c,w=window.screenX,f=window.screenY,_=d.x*h+(window.top?(window.top.outerWidth-window.top.innerWidth*h)/2:0),m=d.y*h+(window.top?window.top.outerHeight-window.top.innerHeight*h-(window.top.outerWidth-window.top.innerWidth*h)/2:103);return t?{x:u*i[0],y:p*i[1],w:a*i[0],h:l*i[1],dpr:devicePixelRatio,background:e,afpx:d.x,afpy:d.y}:{x:e?a*h*i[0]<800?-800:-a*h*i[0]:w+_+u*i[0]*h,y:e?l*h*i[1]<600?-600:-l*h*i[1]:f+m+p*i[1]*h,w:a*h*i[0],h:l*h*i[1]}}_currentFrameAbsolutePosition(){let e,t,n=window,i=[];for(;n!==window.top;){e=n.parent;for(let o=0;o<e.frames.length;o++)if(e.frames[o]===n)try{const o=e.document.getElementsByTagName("iframe");for(let e=0;e<o.length;e++){const s=o[e];s.contentWindow===n&&(t=s.getBoundingClientRect(),i.push({x:t.x,y:t.y}))}n=e;break}catch(e){i.push({x:this._frameInfo.x,y:this._frameInfo.y}),n=window.top;break}}return i.reduce(((e,t)=>({x:e.x+t.x,y:e.y+t.y})),{x:0,y:0})}_batchObserveElement(e,t){var n;try{const i=new MutationObserver((n=>{var i,o,s,r,c;let a=!1;for(const l of n){if(l.removedNodes.length>0)for(let e of l.removedNodes)if(e.contains(this._element))return this._element=null,null===(i=this._io)||void 0===i||i.disconnect(),null===(o=this._ro)||void 0===o||o.disconnect(),void this.emit("hide-control");if(l.addedNodes.length>0)for(let e of l.addedNodes)if(e.contains(this._element))return this.emit("show-control"),this._element=document.getElementById(this._domId),null===(s=this._io)||void 0===s||s.observe(this._element),void(null===(r=this._ro)||void 0===r||r.observe(this._element));if(l.attributeName){const n=l.target;if(n){const i=!t&&n.contains(this._element),o=t&&(n.contains(t)||n===t);if(i||o){let t=this._windowsVisible.get(e),i=this._windowScale.get(e);t||(t=new Map,this._windowsVisible.set(e,t)),i||(i=new Map,this._windowScale.set(e,i));const s=null===(c=n.ownerDocument.defaultView)||void 0===c?void 0:c.getComputedStyle(n);if(s)if("hidden"===s.visibility||"collapse"===s.visibility||"none"===s.display)t.set(n,!1);else{const e=t.has(n);[...t.keys()].filter((e=>e!==n&&n.contains(e))).forEach((e=>{var n;const i=null===(n=e.ownerDocument.defaultView)||void 0===n?void 0:n.getComputedStyle(e);i&&"hidden"!==i.visibility&&"collapse"!==i.visibility&&"none"!==i.display&&(null==t||t.set(e,!0))})),e&&t.set(n,!0)}if(o){const e=n.style;if(-1!==e.transform.indexOf("scale")){const t=e.transform.match(/scale\(.*?\)/);if(t&&t.length>0){let e=1,o=1;const s=t[0].match(/scale\((.*)\)/);if(s&&s.length>1){const t=s[1].split(",");e=parseFloat(t[0]),o=t.length>1&&void 0!==t[1]?parseFloat(t[1]):e,i.set(n,[e,o])}}}else i.set(n,[1,1])}a=!0}}}}const l=[...this._windowsVisible.values()];if(!this._pageVisible&&0===l.length)return;let d=!0;l.forEach((e=>{const t=[...e.values()].reduce(((e,t)=>e&&t),!0);d=d&&t})),!this._domVisible&&d&&this.emit("show-control"),this._domVisible&&!d&&(this.emit("hide-control"),a=!1),a&&this.emit("update-control",!0),this._domVisible=d}));i.observe(e.document.documentElement,{childList:!0,attributes:!0,attributeFilter:["style","class"],subtree:!0}),null===(n=this._mos)||void 0===n||n.push(i);const o=O.bind(this);this._scrollCallbacks.push({callback:o,window:e}),e.addEventListener("scroll",o,!0),e.frameElement&&this._batchObserveElement(e.parent,e.frameElement)}catch(e){}}}function R(){this.controlReady&&(this.controlReady=!1,this.removeEventListener(),this.emit("close-control"))}function O(){let e=requestAnimationFrame((()=>{this.emit("update-control"),cancelAnimationFrame(e)}))}function T(){this.controlReady&&("hidden"!==(null===top||void 0===top?void 0:top.document.visibilityState)||this.ClientFullscreen||function(){const e=window.top?window.top.outerWidth/window.top.innerWidth:1;return top&&(null!=top.document.fullscreenElement||(null===top||void 0===top?void 0:top.document.documentElement.clientWidth)*e/(null===top||void 0===top?void 0:top.window.screen.width)>.99&&(null===top||void 0===top?void 0:top.document.documentElement.clientHeight)*e/(null===top||void 0===top?void 0:top.window.screen.height)>.99)||!top&&!1}()?(this._pageVisible=!0,this.visible&&this.emit("show-tab")):(this._pageVisible=!1,this.emit("hide-control")))}function N(e){if(!e||!e.data||"string"!=typeof e.data)return;const t=e.data;let n;if(n=JSON.parse(t),n.hasOwnProperty("method"))try{let e=window[n.method];if("function"==typeof e){let i=null;t.hasOwnProperty("argument")&&(i=n.argument),i?e(i):e()}}catch(e){}}function D(e,t){const n=/^[1-9]\d?(\.([1-9]?\d)){2}$/;if(n.test(e)&&n.test(t)){const n=e.split("."),i=t.split(".");return n[0]>i[0]||n[0]==i[0]&&(n[1]>i[1]||n[1]==i[1]&&n[2]>=i[2])}return!1}let P=devicePixelRatio;var L,W,V,U,M,F;!function(e){e[e.VISIBLE=0]="VISIBLE",e[e.HIDDEN=1]="HIDDEN"}(L||(L={})),function(e){e.SCENE_TREE="1",e.MAP="2",e.BUTTONS_BOTTOM="3",e.BUTTONS_EXIT_MIN="4",e.SEARCH_BAR="5",e.BUTTON_ALARM="6",e.TOOLBOX_RIGHT="7",e.MAIN_TITLE="8",e.LABEL_STATISTICS="9",e.BALL_WINDOW="10",e.BUTTON_HELP="11",e.BUTTON_MINMAX="12",e.BUTTON_EXIT="13"}(W||(W={})),function(e){e.VISIBLE="0",e.HIDDEN="1",e.CLOSE="2"}(V||(V={})),function(e){e.Fullscreen="1",e.Normal="0"}(U||(U={})),function(e){e[e.UNSETUPED=0]="UNSETUPED",e[e.SETUPED=1]="SETUPED",e[e.UILOADED=2]="UILOADED"}(M||(M={})),function(e){e.STOP="0",e.PLAY="1"}(F||(F={}));class ${constructor(e,t){this.host="ws://127.0.0.1",this.connected=!1,this.setuped=M.UNSETUPED,this.maxReconnectNum=10,this.shouldUpdate=!1,this.version="unknown",this.port=e,this.callbacks=t}connect(){this.ws=new WebSocket(`${this.host}:${this.port}`),this.ws.onopen=e=>{this.connected=!0,this.shouldUpdate&&this.callbacks&&this.callbacks.updatedCallback&&this.callbacks.updatedCallback(),this.shouldUpdate=!1,this.maxReconnectNum=10,this.callbacks&&this.callbacks.connectedCallback&&this.callbacks.connectedCallback(e)},this.ws.onclose=e=>{!this.connected&&this.setuped===M.UNSETUPED&&1e3!==e.code||this.shouldUpdate?this.reconnect():(this.connected=!1,this.setuped=M.UNSETUPED,this.callbacks&&this.callbacks.disconnectedCallback&&this.callbacks.disconnectedCallback(e))},this.ws.onerror=e=>{console.debug(e)},this.ws.onmessage=e=>{var t;const{data:n}=e;if(-1!=n.indexOf("ARStarted"))return this.setuped=M.SETUPED,void(this.callbacks&&this.callbacks.setupedCallback&&this.callbacks.setupedCallback());let i=JSON.parse(n);if(i&&i.topic){if("ARFullscreenClose"==i.topic)return void window.close();if("clientVersion"==i.topic)return void(this.callbacks&&this.callbacks.versionCallback&&this.callbacks.versionCallback(i.content));if("ARControlClicked"==i.topic)return void(this.callbacks&&this.callbacks.controlClickCallback&&this.callbacks.controlClickCallback(i.content));if("autoUpdate"==i.topic&&"1"===i.content)return this.shouldUpdate=!0,this.maxReconnectNum=60,void(null===(t=this.ws)||void 0===t||t.close());if("ARToWebDPI"==i.topic)return void(this.callbacks&&this.callbacks.dpiCallback&&this.callbacks.dpiCallback(i.content));"ARToWebKeys"==i.topic?"F11"!=i.content||function(e,t){const n=/^[1-9]\d?(\.([1-9]?\d)){2}$/;if(n.test(e)&&n.test(t)){const n=e.split("."),i=t.split(".");return n[0]>i[0]||n[0]==i[0]&&(n[1]>i[1]||n[1]==i[1]&&n[2]>=i[2])}return!1}(this.version,"2.2.0")?this.callbacks&&this.callbacks.messageCallback&&this.callbacks.messageCallback(i.topic,i.content):document.fullscreenElement?document.exitFullscreen&&(this.send("windowStatus","1"),document.exitFullscreen(),this.send("windowStatus","0")):document.documentElement.requestFullscreen():"ARWebLoaded"==i.topic&&"1"==i.content?(this.setuped=M.UILOADED,this.callbacks&&this.callbacks.arUILoadedCallback&&this.callbacks.arUILoadedCallback()):"ARFullscreen"==i.topic?this.callbacks&&this.callbacks.fullscreenCallback&&this.callbacks.fullscreenCallback("1"==i.content):this.callbacks&&this.callbacks.messageCallback&&this.callbacks.messageCallback(i.topic,i.content)}}}close(){var e;this.maxReconnectNum=10,null===(e=this.ws)||void 0===e||e.close()}send(e,t){var n,i,o;(null===(n=this.ws)||void 0===n?void 0:n.readyState)===(null===(i=this.ws)||void 0===i?void 0:i.OPEN)&&(null===(o=this.ws)||void 0===o||o.send(JSON.stringify({topic:e,content:t})))}reconnect(){if(this.maxReconnectNum>0){this.maxReconnectNum--;let e=setTimeout((()=>{this.connect(),clearTimeout(e)}),1e3)}else this.callbacks&&this.callbacks.timeoutCallback&&this.callbacks.timeoutCallback()}isConnected(){return this.connected}isSetuped(){return this.setuped}}var B={"0x0001":{code:"0x0001","zh-CN":"AR控件未启动或通信未建立，请先启动控件后再检查通信端口",en:"AR Control is not setuped, please setup control first and then check WS port."},"0x0002":{code:"0x0002","zh-CN":"AR控件UI加载超时，请检查控件登录参数是否正确或根据客户端日志排查内部异常",en:"AR Control UI loaded for long time, please check login params and client exception logs."},"0x0003":{code:"0x0003","zh-CN":"未进行AR控件初始化参数配置，启动控件失败！",en:"AR Control is not configured, control setup failed!"},"0x0004":{code:"0x0004","zh-CN":"已启动AR控件实例，请勿重复启动实例！",en:"AR Control instance is setuped, please not setup instance repeatedly!"},"0x0005":{code:"0x0005","zh-CN":"启动参数未定义domId，无法启动AR控件",en:"domId in setup params is not defined, AR Control cannot be setuped."},"0x0006":{code:"0x0006","zh-CN":"未找到domId定义的DOM元素，请检查",en:"DOM element defined by domId cannot be found, please checkout."},"0x0007":{code:"0x0007","zh-CN":"启动参数loginType类型不正确，请检查",en:"The type of loginType param is not correct, please checkout."},"0x0008":{code:"0x0008","zh-CN":"启动参数ip类型不正确，请检查",en:"The type of ip param is not correct, please checkout."},"0x0009":{code:"0x0009","zh-CN":"启动参数port类型不正确，请检查",en:"The type of port param is not correct, please checkout."},"0x000A":{code:"0x000A","zh-CN":"启动参数userName类型不正确，请检查",en:"The type of userName param is not correct, please checkout."},"0x000B":{code:"0x000B","zh-CN":"启动参数credentials类型不正确，请检查",en:"The type of credentials param is not correct, please checkout."},"0x000C":{code:"0x000C","zh-CN":"AR控件WS通信连接超时，请检查WS端口占用情况和客户端日志异常记录",en:"AR Control websocket connection time out, please check whether local WS is used and client exception logs."},"0x000D":{code:"0x000D","zh-CN":"AR控件WS通信连接失败，无法发送消息，请检查WS端口占用情况",en:"AR Control websocket connection failed, please check whether local WS is used."},"0x000E":{code:"0x000E","zh-CN":"AR控件绑定DOM被销毁，无法执行静默处理，请在文档流中添加绑定ID对应的DOM元素后执行本操作",en:"The DOM which is related to AR control has been destroyed, cannot execute backgroud task, please add a DOM in current document flow whose id is related to the control and try once."},"0x000F":{code:"0x000F","zh-CN":"AR控件版本低于2.2.0，无法执行控件全屏相关API操作，请升级客户端版本或定制旧版本客户端全屏功能",en:"AR Control Version is lower than 2.2.0, cannot execute fullscreen API on the control, please update client version or customize lower version client for fullsreen function."}},z=function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function r(e){try{a(i.next(e))}catch(e){s(e)}}function c(e){try{a(i.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((i=i.apply(e,t||[])).next())}))};class H extends x{constructor(){super(),this._clientVersion="unknown",this.openedVideoIndexCodes=new Map}static getInstance(){return H._instance||(H._instance=new H),H._instance}setup(e){return new Promise(((t,n)=>z(this,void 0,void 0,(function*(){var i;let o;try{o=null===(i=window.top)||void 0===i?void 0:i.document.title}catch(e){}this._options={domId:"ar-div",loginType:3,ip:"",port:"443",userName:"admin",credentials:"",arIndexCode:"",websocketPort:"8888",domainId:"0",setupType:2,title:o||window.document.title,processName:"chrome",visible:!0,hiddenControls:[],launchType:"location",enableDpiAwareness:!1},Object.assign(this._options,e);const s=yield this._loadControl();"0x0000"===s?(this._socket&&this._socket.close(),this._socket=new $(this._options.websocketPort,{setupedCallback:()=>{this._container&&(this._container.controlReady=!0),t()},arUILoadedCallback:()=>{var e;this.emit("ar_ui_loaded"),(null===(e=this._options)||void 0===e?void 0:e.visible)||this.setVideoStatus(F.STOP)},disconnectedCallback:()=>{var e,t,n,i,o,s,r;this.emit("ar_closed"),null===(e=this._container)||void 0===e||e.off("hide-control",this._hideControlCallback),null===(t=this._container)||void 0===t||t.off("change-window",this._updateBrowserCallback),null===(n=this._container)||void 0===n||n.off("show-tab",this._showTabCallback),null===(i=this._container)||void 0===i||i.off("close-control",this._closeControlCallback),null===(o=this._container)||void 0===o||o.off("show-control",this._showControlCallback),null===(s=this._container)||void 0===s||s.off("update-control",this._updateControlCallback),null===(r=this._container)||void 0===r||r.removeEventListener(),this._container&&(this._container.controlReady=!1)},messageCallback:(e,t)=>{if("ARToWebKeys"===e&&(this.emit("ar_keydown",t),"F11"===t&&(this.getFullscreenState()===U.Fullscreen?this.exitFullscreen():this.requestFullscreen())),"ARToWebCustomMessage"===e&&this.emit("ar_custom_message",t),"ARControlSceneChanged"===e){let e=t.split(",");this.emit("ar_scene_change",{sceneIndex:e[0],sceneCode:e[1],sceneName:e[2]})}},timeoutCallback:()=>{this.emit("ar_connect_timeout"),n({code:"0x000C",msg:B["0x000C"][navigator.language]})},updatedCallback:()=>{this._setWebPageHandle()},dpiCallback:e=>{this._container&&(this._container.dpi=e)},versionCallback:e=>{const t=e.match(/V([1-9]\d?(\.([1-9]?\d)){2}).*/);t&&t.length>1&&(this._clientVersion=t[1],this._socket.version=this._clientVersion,this._container.version=this._clientVersion)},fullscreenCallback:e=>{this._container.ClientFullscreen=e},controlClickCallback:e=>{"close"===e&&this.emit("ar_close_click"),"minimize"===e&&this.emit("ar_minimize_click")}}),this._socket.connect()):n({code:s,msg:B[s][navigator.language]})}))))}setARShowMode(e){return new Promise(((t,n)=>{var i,o,s,r,c;if(this._socket){if(this._options.visible=!e,(null===(i=this._options)||void 0===i?void 0:i.visible)?this._setARWindowStatus(V.VISIBLE):this._setARWindowStatus(V.HIDDEN),!(null===(o=this._container)||void 0===o?void 0:o.element))return;const a=null===(s=this._container)||void 0===s?void 0:s.getDomPosition(!(null===(r=this._options)||void 0===r?void 0:r.visible),null===(c=this._options)||void 0===c?void 0:c.enableDpiAwareness);this._socket.isSetuped()!==M.UNSETUPED?(this._setARWindowPosition(a),t()):n({code:"0x000D",msg:B["0x000D"][navigator.language]})}else n({code:"0x0001",msg:B["0x0001"][navigator.language]})}))}close(){return new Promise(((e,t)=>{if(this._socket){this._socket.isSetuped()!==M.UNSETUPED?(Object.defineProperty(this._socket,"setuped",{set(t){t||e()}}),this._setARWindowStatus(V.CLOSE),e()):t({code:"0x000D",msg:B["0x000D"][navigator.language]})}else t({code:"0x0001",msg:B["0x0001"][navigator.language]})}))}changeARScene(e){return new Promise(((t,n)=>{this._checkARUILoaded().then((()=>{this._socket&&(this._socket.send("changeScene",e),t())}),(e=>{n({code:e,msg:B[e][navigator.language]})}))}))}sendBusinessInfo(e){return new Promise(((t,n)=>{if(this._socket){this._socket.isConnected()?(this._socket.send("sendCustomInfo",e),t()):n({code:"0x000D",msg:B["0x000D"][navigator.language]})}else n({code:"0x0001",msg:B["0x0001"][navigator.language]})}))}setVideoWindow(e,t){return new Promise(((n,i)=>{this._checkARUILoaded().then((()=>{const{indexCode:i,name:o="",left:s=0,top:r=0}=t;e===V.VISIBLE&&this.openedVideoIndexCodes.set(i,{left:s,top:r});let c={left:(window.top?(window.top.outerWidth-window.top.innerWidth)/2:0)+s,top:(window.top?window.top.outerHeight-window.top.innerHeight-(window.top.outerWidth-window.top.innerWidth)/2:103)+r,index:i,name:o,status:e,width:448,height:430};this._socket&&(this._socket.send("smallVideoPlay",JSON.stringify(c)),n())}),(e=>{i({code:e,msg:B[e][navigator.language]})}))}))}setVideoWindowList(e){return new Promise(((t,n)=>{this._checkARUILoaded().then((()=>{let n=[];!window.top||Math.abs(window.top.outerWidth-window.top.innerWidth*devicePixelRatio)>100||window.devicePixelRatio;e.forEach((e=>{n.push({left:(window.top?(window.top.outerWidth-window.top.innerWidth)/2:0)+e.left,top:(window.top?window.top.outerHeight-window.top.innerHeight-(window.top.outerWidth-window.top.innerWidth)/2:103)+e.top,index:e.indexCode,name:e.name})})),this._socket&&(this._socket.send("smallVideoMoveList",JSON.stringify(n)),t())}),(e=>{n({code:e,msg:B[e][navigator.language]})}))}))}setControlsVisibility(e){return new Promise(((t,n)=>{this._checkARUILoaded().then((()=>{let n=[];for(let t in W)-1!=e.indexOf(W[t])?n.push({Key:W[t],Status:L.HIDDEN}):n.push({Key:W[t],Status:L.VISIBLE});this._socket&&(this._socket.send("setARMainControlsVisible",JSON.stringify(n)),t())}),(e=>{n({code:e,msg:B[e][navigator.language]})}))}))}setVideoStatus(e){return new Promise(((t,n)=>{this._socket?(this._socket.send("videoStatus",e),t()):n({code:"0x0001",msg:B["0x0001"][navigator.language]})}))}requestFullscreen(){return new Promise(((e,t)=>{this.isVersionLatest()?this._socket?(this._socket.send("fullscreen",""),e()):t({code:"0x0001",msg:B["0x0001"][navigator.language]}):t({code:"0x000F",msg:B["0x000F"][navigator.language]})}))}exitFullscreen(){return new Promise(((e,t)=>{this.isVersionLatest()?this._socket?(this._socket.send("exitFullscren",""),e()):t({code:"0x0001",msg:B["0x0001"][navigator.language]}):t({code:"0x000F",msg:B["0x000F"][navigator.language]})}))}getFullscreenState(){return this._container.ClientFullscreen?U.Fullscreen:U.Normal}isVersionLatest(){return"unknown"!=this._clientVersion&&function(e,t){const n=/^[1-9]\d?(\.([1-9]?\d)){2}$/;if(n.test(e)&&n.test(t)){const n=e.split("."),i=t.split(".");return n[0]>i[0]||n[0]==i[0]&&(n[1]>i[1]||n[1]==i[1]&&n[2]>=i[2])}return!1}(this._clientVersion,"2.2.0")}_loadControl(){var e;return z(this,void 0,void 0,(function*(){if(!this._options)return"0x0003";if(this._container&&this._container.controlReady)return"0x0004";const{domId:t,loginType:n,ip:i,port:o,userName:s,credentials:r,setupType:c,arIndexCode:a,title:l,processName:d,websocketPort:h,domainId:u,frameInfo:p,visible:w,hiddenControls:f,launchType:_,enableDpiAwareness:m}=this._options;if(!t)return"0x0005";if(!document.getElementById(t))return"0x0006";if(![0,1,3].some((e=>e===n)))return"0x0007";if(!i||"string"!=typeof i)return"0x0008";if(!o||"string"!=typeof o)return"0x0009";if(!s||"string"!=typeof s)return"0x000A";if(!r||"string"!=typeof r)return"0x000B";this._container=p?new I(t,p):new I(t),this._hideControlCallback=()=>{this._setARWindowStatus(V.HIDDEN),this.openedVideoIndexCodes.forEach(((e,t)=>{this.setVideoWindow(V.CLOSE,{indexCode:t})})),this.openedVideoIndexCodes.clear()},this._updateBrowserCallback=()=>{this._setWebPageHandle()},this._showTabCallback=()=>{this._setARWindowStatus(V.VISIBLE)},this._closeControlCallback=()=>{var e;this._setARWindowStatus(V.CLOSE),null===(e=this._socket)||void 0===e||e.close()},this._showControlCallback=()=>{this._setARWindowStatus(V.VISIBLE)},this._updateControlCallback=()=>{var e,t,n,i;if((null===(e=this._container)||void 0===e?void 0:e.visible)&&this._container.element){const e=null===(t=this._container)||void 0===t?void 0:t.getDomPosition(!(null===(n=this._options)||void 0===n?void 0:n.visible),null===(i=this._options)||void 0===i?void 0:i.enableDpiAwareness);this._setARWindowPosition(e)}},this._container.on("hide-control",this._hideControlCallback),this._container.on("show-tab",this._showTabCallback),this._container.on("change-window",this._updateBrowserCallback),this._container.on("close-control",this._closeControlCallback),this._container.on("show-control",this._showControlCallback),this._container.on("update-control",this._updateControlCallback);const{x:v,y:b,w:g,h:k,dpr:y,background:C,afpx:x,afpy:E}=this._container.getDomPosition(!w,null===(e=this._options)||void 0===e?void 0:e.enableDpiAwareness),A=JSON.stringify({background:C,dpr:y,afpx:x,afpy:E});let S="",R=r;const O=encodeURIComponent(s),T=encodeURIComponent(R),N="8888"!==h||"chrome"!==d?3:c,{supporterVs:D}=function(){const e=navigator.userAgent.toLowerCase(),t=t=>t.test(e),n=t=>e.match(t).toString().replace(/[^0-9|_.]/g,"").replace(/_/g,".");let i="unknow";t(/windows|win32|win64|wow32|wow64/g)?i="windows":t(/macintosh|macintel/g)?i="macos":t(/x11/g)?i="linux":t(/android|adr/g)?i="android":t(/ios|iphone|ipad|ipod|iwatch/g)&&(i="ios");let o="unknow";"windows"===i?t(/windows nt 5.0|windows 2000/g)?o="2000":t(/windows nt 5.1|windows xp/g)?o="xp":t(/windows nt 5.2|windows 2003/g)?o="2003":t(/windows nt 6.0|windows vista/g)?o="vista":t(/windows nt 6.1|windows 7/g)?o="7":t(/windows nt 6.2|windows 8/g)?o="8":t(/windows nt 6.3|windows 8.1/g)?o="8.1":t(/windows nt 10.0|windows 10/g)&&(o="10"):"macos"===i?o=n(/os x [\d._]+/g):"android"===i?o=n(/android [\d._]+/g):"ios"===i&&(o=n(/os [\d._]+/g));let s="unknow";"windows"===i||"macos"===i||"linux"===i?s="desktop":("android"===i||"ios"===i||t(/mobile/g))&&(s="mobile");let r="unknow",c="unknow";t(/applewebkit/g)?(r="webkit",t(/edge?/g)?c="edge":t(/opr/g)?c="opera":t(/chrome/g)?c="chrome":t(/safari/g)&&(c="safari")):t(/gecko/g)&&t(/firefox/g)?(r="gecko",c="firefox"):t(/presto/g)?(r="presto",c="opera"):t(/trident|compatible|msie/g)&&(r="trident",c="iexplore");let a="unknow";"webkit"===r?a=n(/applewebkit\/[\d._]+/g):"gecko"===r?a=n(/gecko\/[\d._]+/g):"presto"===r?a=n(/presto\/[\d._]+/g):"trident"===r&&(a=n(/trident\/[\d._]+/g));let l="unknow";"chrome"===c?l=n(/chrome\/[\d._]+/g):"safari"===c?l=n(/version\/[\d._]+/g):"firefox"===c?l=n(/firefox\/[\d._]+/g):"opera"===c?l=n(/opr\/[\d._]+/g):"iexplore"===c?l=n(/(msie [\d._]+)|(rv:[\d._]+)/g):"edge"===c&&(l=n(/edge?\/[\d._]+/g));let d="none",h="unknow";t(/micromessenger/g)?(d="wechat",h=n(/micromessenger\/[\d._]+/g)):t(/qqbrowser/g)?(d="qq",h=n(/qqbrowser\/[\d._]+/g)):t(/ucbrowser/g)?(d="uc",h=n(/ucbrowser\/[\d._]+/g)):t(/qihu 360se/g)?d="360":t(/2345explorer/g)?(d="2345",h=n(/2345explorer\/[\d._]+/g)):t(/metasr/g)?d="sougou":t(/lbbrowser/g)?d="liebao":t(/maxthon/g)&&(d="maxthon",h=n(/maxthon\/[\d._]+/g));if("chrome"===c&&"userAgentData"in navigator){const e=navigator.userAgentData;"brands"in e&&(c=e.brands.some((e=>"Google Chrome"===e.brand))?"chrome":"chromium")}return Object.assign({engine:r,engineVs:a,platform:s,supporter:c,supporterVs:l,system:i,systemVs:o},"none"===d?{}:{shell:d,shellVs:h})}(),P=D.split(".");let L=!1;if(P.length>0){parseInt(P[0])>=130&&(L=!0)}if(L){const e=null==f?void 0:f.join(","),t={compSetupType:N,ip:i,port:o,userName:s,credentials:r,arIndexCode:a,loginType:n,domainId:u,x:v,y:b,w:g,h:k,title:l,processName:d,hiddenControls:e,websocketPort:h,operate:null,dpiJson:""};m&&(t.dpiJson=A),S=`PCCLoud://WEBUP${btoa(unescape(encodeURIComponent(JSON.stringify(t))))}`}else if(0===n?S=`PCCLoud://UP ${i}:${o} ${O} ${T} *${N} ${a} ${v} ${b} ${g} ${k} ${l}`:1===n?S=`PCCLoud://UP ${i}:${o} ${O} ${T} *${N} ${a} ${v} ${b} ${g} ${k} 0 ${l}`:3===n&&(S=`PCCLoud://UP ${i}:${o} ${O} ${T} *${N} ${a} ${v} ${b} ${g} ${k} tgc ${u} ${l}`),3===N){let e=[h];("chrome"!==d||0!==(null==f?void 0:f.length)||m)&&e.push(d,null==f?void 0:f.join(",")),m&&e.push(A),S+=" "+e.join("&")}return"location"===_?window.location.href=S:window.open(S),"0x0000"}))}_setWebPageHandle(){var e;const{title:t=window.document.title}=this._options;null===(e=this._socket)||void 0===e||e.send("setARParentWebPage",t)}_setARWindowStatus(e){var t;e===V.HIDDEN?this.setVideoStatus(F.STOP):e===V.VISIBLE&&this.setVideoStatus(F.PLAY),null===(t=this._socket)||void 0===t||t.send("windowStatus",e)}_setARWindowPosition(e){var t;const n=JSON.stringify({left:e.x,top:e.y,ctrl_width:e.w,ctrl_height:e.h,background:e.background,devicePixelRatio:e.dpr,absoluteFramePosX:e.afpx,absoluteFramePosY:e.afpy});null===(t=this._socket)||void 0===t||t.send("position",n)}_checkARUILoaded(){return new Promise(((e,t)=>{if(this._socket){const n=this._socket.isSetuped();if(n===M.UILOADED)e();else if(n===M.SETUPED){let n=10,i=setInterval((()=>{this._socket&&this._socket.isSetuped()===M.UILOADED?(clearInterval(i),e()):n>0?n--:t("0x0002")}),500)}else t("0x000D")}else t("0x0001")}))}}var j={ARControlStatus:L,ARControls:W,ARWindowStatus:V,ARWebControl:H,VideoStatus:F,ARWindowState:U};return t=t.default}()}));
//# sourceMappingURL=har.min.js.map